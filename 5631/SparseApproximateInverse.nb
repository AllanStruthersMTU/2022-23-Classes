(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     16883,        447]
NotebookOptionsPosition[     14695,        404]
NotebookOutlinePosition[     15159,        422]
CellTagsIndexPosition[     15116,        419]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Sparse Approximate Inverse", "Title",
 CellChangeTimes->{{3.868969974574915*^9, 3.868970011142788*^9}, {
  3.8709496289195943`*^9, 3.870949644903387*^9}, {3.871556299015231*^9, 
  3.871556300095087*^9}, {3.8757117450549607`*^9, 3.87571176980505*^9}, {
  3.8769238221165433`*^9, 
  3.8769238342292843`*^9}},ExpressionUUID->"913952a7-d0ac-4226-ab6f-\
48622723466e"],

Cell[CellGroupData[{

Cell["Intro", "Chapter",
 CellChangeTimes->{{3.876924098954567*^9, 
  3.876924101578245*^9}},ExpressionUUID->"d0c80401-67f3-4fc5-84e1-\
cf8d7b89683b"],

Cell[TextData[{
 "Suppose we have an ",
 Cell[BoxData[
  FormBox[
   RowBox[{"n", "\[Times]", "n"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "cf7470d8-93b3-4b8b-81e1-fda16ecc3d42"],
 " sparse matrix ",
 Cell[BoxData[
  FormBox["A", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "9c8144fb-1ea5-44ee-9d2f-964cf7b4a065"],
 " then we can find the sparse matrix P (with a specified sparsity pattern) \
that minimizes \n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{"||", 
    RowBox[{
     RowBox[{"P", ".", "A"}], "-", "I"}], 
    SubsuperscriptBox["||", "F", "2"]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "df5a8553-3cc3-451c-b8f7-5de5b604be0e"],
 ".\nSpecifically if ",
 Cell[BoxData[
  FormBox["\[ScriptCapitalP]", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "f3bfad8b-422b-4701-ace2-359eb33b8953"],
 " is a sparsity pattern class then \n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["argmin", 
     RowBox[{"P", "\[Element]", "\[ScriptCapitalP]"}]], "||", 
    RowBox[{
     RowBox[{"P", ".", "A"}], "-", "I"}], 
    SubsuperscriptBox["||", "F", "2"]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "5b31c069-bda9-4d76-a4f5-ce3353c156e1"],
 "\ncan be computed relatively efficiently.  The minimum is well defined \
because the cost function is a positive definite sum of squares in the \
non-zero entries of P. The minimizer is unique unless the sum of squares is \
degenerate!  "
}], "Text",
 CellChangeTimes->{{3.8715563034649286`*^9, 3.871556419189464*^9}, {
   3.875711774149787*^9, 3.875711839860138*^9}, {3.87571187848425*^9, 
   3.8757119381589317`*^9}, {3.875711977483982*^9, 3.875711998932414*^9}, {
   3.87571215035605*^9, 3.8757133473343477`*^9}, {3.8757155743380547`*^9, 
   3.875715612810854*^9}, {3.875715689249301*^9, 3.875715689521443*^9}, {
   3.875717925891738*^9, 3.8757183641982207`*^9}, {3.8757183969249845`*^9, 
   3.87571895253306*^9}, {3.875777937901823*^9, 3.8757784599804015`*^9}, 
   3.875781110280394*^9, {3.8769238483747644`*^9, 3.876924429069441*^9}, {
   3.8769249889677916`*^9, 
   3.8769250066172285`*^9}},ExpressionUUID->"0af0555f-657c-4536-8b7b-\
cdcb2cb05167"],

Cell[TextData[{
 "Note, if A is invertible and we consider dense matrices the minimum zero is \
attained when ",
 Cell[BoxData[
  FormBox[
   RowBox[{"P", "=", 
    SuperscriptBox["A", 
     RowBox[{"-", "1"}]]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "e19dc4bd-4857-4bda-bd30-8665ce86e975"],
 ".     "
}], "Text",
 CellChangeTimes->{{3.8715563034649286`*^9, 3.871556419189464*^9}, {
   3.875711774149787*^9, 3.875711839860138*^9}, {3.87571187848425*^9, 
   3.8757119381589317`*^9}, {3.875711977483982*^9, 3.875711998932414*^9}, {
   3.87571215035605*^9, 3.8757133473343477`*^9}, {3.8757155743380547`*^9, 
   3.875715612810854*^9}, {3.875715689249301*^9, 3.875715689521443*^9}, {
   3.875717925891738*^9, 3.8757183641982207`*^9}, {3.8757183969249845`*^9, 
   3.87571895253306*^9}, {3.875777937901823*^9, 3.8757784599804015`*^9}, 
   3.875781110280394*^9, {3.8769238483747644`*^9, 
   3.8769244680059347`*^9}},ExpressionUUID->"e5630668-9836-49eb-9883-\
b7c43bbfe45e"],

Cell[CellGroupData[{

Cell["Parallel Algorithm", "Subsection",
 CellChangeTimes->{{3.8757811193964624`*^9, 3.875781122492303*^9}, {
  3.876924494980335*^9, 
  3.8769245107997136`*^9}},ExpressionUUID->"3c770a7c-3bdc-4c0c-9073-\
b645a722b90d"],

Cell[TextData[{
 "Of course, the product ",
 Cell[BoxData[
  FormBox[
   RowBox[{"P", ".", "A"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "9bd4deeb-ca95-455f-b32d-d09e26521ce3"],
 " is computed by running along the rows of P and down the columns of A.  So \
each row of ",
 Cell[BoxData[
  FormBox[
   RowBox[{"P", ".", "A"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "af4c0a0d-5f69-4113-9595-9862c1a03a25"],
 " depends only on the corresponding row of ",
 Cell[BoxData[
  FormBox["P", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "ed93da9c-bd0f-4768-9ad8-9f37c435466e"],
 ". Splitting the cost function up by row shows that each row of P is \
determined by minimizing the reduced cost function\n\t ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["argmin", 
     RowBox[{
      RowBox[{"P", "\[LeftDoubleBracket]", 
       RowBox[{"i", ",", ":"}], "\[RightDoubleBracket]"}], "\[Element]", 
      SubscriptBox["\[ScriptCapitalP]", "i"]}]], "||", 
    RowBox[{
     RowBox[{
      RowBox[{"P", "\[LeftDoubleBracket]", 
       RowBox[{"i", ",", ":"}], "\[RightDoubleBracket]"}], ".", "A"}], "-", 
     SubscriptBox["e", "i"]}], 
    SubsuperscriptBox["||", " ", "2"]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "02552359-ecfe-4084-a3ae-ed01063106b1"],
 ".\nIn other words, each row of ",
 Cell[BoxData[
  FormBox["P", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "e6a523da-bdad-4bc7-afd5-fe5ce4f0974b"],
 " is determined by a substantially smaller least squares problem defined by \
the product of a sparse vector and the sparse matrix ",
 Cell[BoxData[
  FormBox["A", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "31ac2c3d-b1c7-4fb4-acc9-7ed98ed6ed06"],
 ". "
}], "Text",
 CellChangeTimes->{{3.8769245251244383`*^9, 3.87692497675415*^9}, {
  3.8769250214438457`*^9, 
  3.8769250616911154`*^9}},ExpressionUUID->"97cd02c6-6123-4726-9eee-\
6fe152af2c6f"],

Cell[TextData[{
 "If row i of P has ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["nz", "i"], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "b96e6292-e66c-42c3-800b-6d87bf17a2ac"],
 " allowed non-zeros then the LS problem for row i is ",
 Cell[BoxData[
  FormBox[
   RowBox[{"n", "\[Times]", 
    SubscriptBox["nz", "i"]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "1b15fbb6-0208-4ef3-95b0-6d3bedc74323"],
 ".  The problems for each row are completely independent!  They require no \
communication.  Such a problem is called embarrassingly parallel.  "
}], "Text",
 CellChangeTimes->{{3.876925087451438*^9, 
  3.8769253096401434`*^9}},ExpressionUUID->"6b5a8b1e-2601-4a87-b664-\
0c1ab1187bc8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Small Scale Demo", "Subsection",
 CellChangeTimes->{{3.8757811193964624`*^9, 3.875781122492303*^9}, {
  3.876924494980335*^9, 3.8769245107997136`*^9}, {3.876925335367919*^9, 
  3.876925346104046*^9}},ExpressionUUID->"24eddf11-cd56-43ed-9161-\
a750fa4d7751"],

Cell["Suppose my matrix is ", "Text",
 CellChangeTimes->{{3.876925353328519*^9, 
  3.8769253696574893`*^9}},ExpressionUUID->"fd465a06-fd07-4ab6-b5bb-\
f453a121c65c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"A", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"2.0", "0", "0", "1.2"},
      {"1.2", "4.0", "0", "0"},
      {"0", "0", "3.1", "0.1"},
      {"0", "0.1", "0", "0.6"}
     }], "\[NoBreak]", ")"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.876925372593523*^9, 3.876925450266952*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"0f6c5c88-aff6-4bf8-a410-284349ef62c3"],

Cell["\<\
I can assume that my P has the same sparsity pattern as A in other words.\
\>", "Text",
 CellChangeTimes->{{3.8769245251244383`*^9, 3.87692497675415*^9}, {
  3.8769250214438457`*^9, 3.8769250616911154`*^9}, {3.8769254683596587`*^9, 
  3.876925499922634*^9}},ExpressionUUID->"ebe16424-5f58-4cda-954b-\
4d2eaba954cc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"P", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"p11", "0", "0", "p14"},
      {"p21", "p22", "0", "0"},
      {"0", "0", "p33", "p34"},
      {"0", "p42", "0", "p44"}
     }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Id", "=", 
   RowBox[{"IdentityMatrix", "[", "4", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.876925503654912*^9, 3.876925567262843*^9}, {
  3.876925660232092*^9, 3.8769256645828695`*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"07a34d85-e4be-4c02-9986-ee1d05a0da58"],

Cell["Then the 4 partial objective functions are ", "Text",
 CellChangeTimes->{{3.8769255695755844`*^9, 3.8769255781538982`*^9}, {
  3.8769256240159955`*^9, 
  3.8769256347052903`*^9}},ExpressionUUID->"ab93f248-5ac0-4529-9561-\
b719d2e21da2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Table", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"temp", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"P", "\[LeftDoubleBracket]", 
        RowBox[{"i", ",", "All"}], "\[RightDoubleBracket]"}], ".", "A"}], "-", 
      RowBox[{"Id", "\[LeftDoubleBracket]", 
       RowBox[{"i", ",", "All"}], "\[RightDoubleBracket]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Simplify", "[", 
     RowBox[{"temp", ".", "temp"}], "]"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.876925580827691*^9, 3.87692571575137*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"a7695941-d540-49ef-a1be-a679f70e0b90"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"1.`", "\[VeryThinSpace]", "+", 
    RowBox[{"5.4399999999999995`", " ", 
     SuperscriptBox["p11", "2"]}], "+", 
    RowBox[{"0.37`", " ", 
     SuperscriptBox["p14", "2"]}], "+", 
    RowBox[{"p11", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "4.`"}], "+", 
       RowBox[{"1.44`", " ", "p14"}]}], ")"}]}]}], ",", 
   RowBox[{"1.`", "\[VeryThinSpace]", "+", 
    RowBox[{"5.4399999999999995`", " ", 
     SuperscriptBox["p21", "2"]}], "-", 
    RowBox[{"8.`", " ", "p22"}], "+", 
    RowBox[{"4.8`", " ", "p21", " ", "p22"}], "+", 
    RowBox[{"17.44`", " ", 
     SuperscriptBox["p22", "2"]}]}], ",", 
   RowBox[{"1.`", "\[VeryThinSpace]", "+", 
    RowBox[{"9.620000000000001`", " ", 
     SuperscriptBox["p33", "2"]}], "+", 
    RowBox[{"p33", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "6.2`"}], "+", 
       RowBox[{"0.12`", " ", "p34"}]}], ")"}]}], "+", 
    RowBox[{"0.37`", " ", 
     SuperscriptBox["p34", "2"]}]}], ",", 
   RowBox[{"1.`", "\[VeryThinSpace]", "+", 
    RowBox[{"17.44`", " ", 
     SuperscriptBox["p42", "2"]}], "-", 
    RowBox[{"1.2`", " ", "p44"}], "+", 
    RowBox[{"0.8`", " ", "p42", " ", "p44"}], "+", 
    RowBox[{"0.37`", " ", 
     SuperscriptBox["p44", "2"]}]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.876925705145771*^9, 3.8769257164993954`*^9}},
 CellLabel->"Out[12]=",ExpressionUUID->"9733ead9-59a8-4425-b830-ee8ccda17f30"]
}, Open  ]],

Cell["\<\
The minimizer of each is easily computed by setting the derivatives equal to \
zero\
\>", "Text",
 CellChangeTimes->{{3.8769257581490793`*^9, 
  3.8769258198333387`*^9}},ExpressionUUID->"bf912a5b-1399-4392-940b-\
cab0a4a37d26"],

Cell[TextData[{
 "\nOf course, the product ",
 Cell[BoxData[
  FormBox[
   RowBox[{"P", ".", "A"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "86150832-c078-4a95-8332-71cdd023eef8"],
 " is computed by running along the rows of P and down the columns of A.  So \
each row of ",
 Cell[BoxData[
  FormBox[
   RowBox[{"P", ".", "A"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "d4a66639-8270-44f4-b037-670b5ed22248"],
 " depends only on the corresponding row of ",
 Cell[BoxData[
  FormBox["P", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "e108492a-5167-4c47-b3a8-89e8dca72b05"],
 ". Splitting the cost function up by row shows that each row of P is \
determined by minimizing the reduced cost function\n\t ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["argmin", 
     RowBox[{
      RowBox[{"P", "\[LeftDoubleBracket]", 
       RowBox[{"i", ",", ":"}], "\[RightDoubleBracket]"}], "\[Element]", 
      SubscriptBox["\[ScriptCapitalP]", "i"]}]], "||", 
    RowBox[{
     RowBox[{
      RowBox[{"P", "\[LeftDoubleBracket]", 
       RowBox[{"i", ",", ":"}], "\[RightDoubleBracket]"}], ".", "A"}], "-", 
     SubscriptBox["e", "i"]}], 
    SubsuperscriptBox["||", " ", "2"]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "300a9912-76fb-4087-aa6a-6e93724185ce"],
 ".\nIn other words, each row of ",
 Cell[BoxData[
  FormBox["P", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "bf6eb86e-1734-4d05-873e-c12eddb7c8ec"],
 " is determined by a substantially smaller least squares problem defined by \
the product of a sparse vector and the sparse matrix ",
 Cell[BoxData[
  FormBox["A", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "13d3f2dd-ddc2-471d-9ec3-71415d6f1df3"],
 ". "
}], "Text",
 CellChangeTimes->{{3.8769245251244383`*^9, 3.87692497675415*^9}, {
  3.8769250214438457`*^9, 3.8769250616911154`*^9}, {3.8769254683596587`*^9, 
  3.8769254955546737`*^9}},ExpressionUUID->"97b7fadd-d3f4-45e4-964d-\
871791dbc69e"],

Cell[TextData[{
 "If row i of P has ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["nz", "i"], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "199a6136-907e-430d-ac0c-ad654b381525"],
 " allowed non-zeros then the LS problem for row i is ",
 Cell[BoxData[
  FormBox[
   RowBox[{"n", "\[Times]", 
    SubscriptBox["nz", "i"]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "112aa450-1855-4978-92cf-ad45650f0b9e"],
 ".  The problems for each row are completely independent!  They require no \
communication.  Such a problem is called embarrassingly parallel.  "
}], "Text",
 CellChangeTimes->{{3.876925087451438*^9, 
  3.8769253096401434`*^9}},ExpressionUUID->"d307ffea-1f8d-4182-ae92-\
9d77a5d1fe20"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowToolbars->"EditBar",
WindowSize->{955.5, 575.},
WindowMargins->{{Automatic, -1549}, {Automatic, -137.5}},
Magnification:>1.5 Inherited,
FrontEndVersion->"12.3 for Microsoft Windows (64-bit) (May 11, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"b4be8a74-2649-4a33-9214-cbe7e00a15cf"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 369, 6, 146, "Title",ExpressionUUID->"913952a7-d0ac-4226-ab6f-48622723466e"],
Cell[CellGroupData[{
Cell[974, 32, 150, 3, 102, "Chapter",ExpressionUUID->"d0c80401-67f3-4fc5-84e1-cf8d7b89683b"],
Cell[1127, 37, 2232, 53, 294, "Text",ExpressionUUID->"0af0555f-657c-4536-8b7b-cdcb2cb05167"],
Cell[3362, 92, 996, 21, 87, "Text",ExpressionUUID->"e5630668-9836-49eb-9883-b7c43bbfe45e"],
Cell[CellGroupData[{
Cell[4383, 117, 219, 4, 81, "Subsection",ExpressionUUID->"3c770a7c-3bdc-4c0c-9073-b645a722b90d"],
Cell[4605, 123, 2010, 53, 263, "Text",ExpressionUUID->"97cd02c6-6123-4726-9eee-6fe152af2c6f"],
Cell[6618, 178, 740, 19, 121, "Text",ExpressionUUID->"6b5a8b1e-2601-4a87-b664-0c1ab1187bc8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7395, 202, 263, 4, 81, "Subsection",ExpressionUUID->"24eddf11-cd56-43ed-9161-a750fa4d7751"],
Cell[7661, 208, 165, 3, 52, "Text",ExpressionUUID->"fd465a06-fd07-4ab6-b5bb-f453a121c65c"],
Cell[7829, 213, 404, 10, 116, "Input",ExpressionUUID->"0f6c5c88-aff6-4bf8-a410-284349ef62c3"],
Cell[8236, 225, 325, 6, 52, "Text",ExpressionUUID->"ebe16424-5f58-4cda-954b-4d2eaba954cc"],
Cell[8564, 233, 568, 14, 154, "Input",ExpressionUUID->"07a34d85-e4be-4c02-9986-ee1d05a0da58"],
Cell[9135, 249, 242, 4, 52, "Text",ExpressionUUID->"ab93f248-5ac0-4529-9561-b719d2e21da2"],
Cell[CellGroupData[{
Cell[9402, 257, 737, 17, 128, "Input",ExpressionUUID->"a7695941-d540-49ef-a1be-a679f70e0b90"],
Cell[10142, 276, 1453, 38, 142, "Output",ExpressionUUID->"9733ead9-59a8-4425-b830-ee8ccda17f30"]
}, Open  ]],
Cell[11610, 317, 237, 6, 52, "Text",ExpressionUUID->"bf912a5b-1399-4392-940b-cab0a4a37d26"],
Cell[11850, 325, 2062, 53, 297, "Text",ExpressionUUID->"97b7fadd-d3f4-45e4-964d-871791dbc69e"],
Cell[13915, 380, 740, 19, 121, "Text",ExpressionUUID->"d307ffea-1f8d-4182-ae92-9d77a5d1fe20"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

